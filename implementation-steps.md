# 词组复习游戏 - 详细实现步骤规划

## 一、前期准备工作

### 1. 代码分析
1. 分析现有代码结构
   - game.js: 游戏核心逻辑
   - ui.js: 界面交互处理
   - styles.css: 样式定义
   
2. 梳理数据流向
   - 题库加载流程
   - 答题状态管理
   - 分数计算逻辑

### 2. 模块划分
1. 数据加载模块
   - URL参数解析器
   - 题库加载器（文件/Base64）
   - 数据验证器

2. 状态管理模块
   - 答题状态追踪
   - 错误计数器
   - 完成状态检测

3. UI展示模块
   - 完成页面生成器
   - 错题统计展示器
   - 复习链接生成器

## 二、具体实现步骤

### 第一阶段：数据加载系统
1. URL参数处理类（game.js）
   ```
   实现步骤：
   1. 创建 URLParamsManager 类
   2. 实现参数解析方法
   3. 添加参数有效性验证
   4. 整合到现有初始化流程
   ```

2. 题库加载系统（game.js）
   ```
   实现步骤：
   1. 创建 PhraseLoader 类
   2. 实现文件加载方法
   3. 实现 Base64 解码方法
   4. 添加数据格式验证
   5. 实现加载失败处理
   ```

### 第二阶段：状态管理系统
1. 答题状态管理（game.js）
   ```
   实现步骤：
   1. 扩展 Phrase 数据结构
   2. 实现状态追踪方法
   3. 修改得分计算逻辑
   4. 添加完成检测机制
   ```

2. 错题管理（game.js）
   ```
   实现步骤：
   1. 创建 ErrorTracker 类
   2. 实现错误计数方法
   3. 添加错题收集功能
   4. 实现错题排序功能
   ```

### 第三阶段：界面系统
1. 完成页面（ui.js）
   ```
   实现步骤：
   1. 创建 CompletionScreen 类
   2. 实现统计信息展示
   3. 实现错题列表展示
   4. 添加样式定义
   ```

2. 复习功能（ui.js）
   ```
   实现步骤：
   1. 创建 ReviewManager 类
   2. 实现错题数据处理
   3. 实现 Base64 转换
   4. 实现跳转链接生成
   ```

## 三、实现细节

### 1. 数据结构设计
```typescript
// 题目数据结构
interface Phrase {
    full: string;          // 完整词组
    sentence: string;      // 例句
    errorCount: number;    // 错误次数
    attempted: boolean;    // 是否已尝试
    scored: boolean;       // 是否已得分
}

// 答题状态结构
interface GameState {
    currentScore: number;  // 当前分数
    totalQuestions: number;// 总题目数
    completed: boolean;    // 是否完成
    wrongAnswers: Phrase[]; // 错题列表
}
```

### 2. 关键函数实现

#### 题库加载
```typescript
实现思路：
1. 检测 URL 参数
2. 根据参数类型选择加载方式
3. 验证数据格式
4. 初始化题库状态
```

#### 答题状态追踪
```typescript
实现思路：
1. 记录每题的尝试状态
2. 统计错误次数
3. 更新得分情况
4. 检测完成状态
```

#### 错题复习生成
```typescript
实现思路：
1. 筛选错题
2. 重置题目状态
3. 生成 Base64 数据
4. 构造跳转链接
```

## 四、测试规划

### 1. 单元测试
1. 数据加载测试
   - URL 参数解析
   - Base64 解码
   - JSON 格式验证

2. 状态管理测试
   - 答题状态更新
   - 分数计算
   - 完成检测

### 2. 集成测试
1. 完整流程测试
   - 题库加载到完成
   - 错题生成与跳转
   - 数据持久性检查

2. 界面交互测试
   - 答题反馈
   - 完成页面展示
   - 复习功能可用性

## 五、注意事项

### 1. 代码质量
- 遵循模块化原则
- 保持代码可测试性
- 添加适当的注释
- 处理所有可能的错误情况

### 2. 性能考虑
- 优化数据结构
- 减少不必要的计算
- 控制内存使用
- 优化页面渲染

### 3. 用户体验
- 添加适当的加载提示
- 保持界面响应性
- 提供清晰的错误提示
- 确保操作流程顺畅

### 4. 安全性
- 验证所有输入数据
- 防止 XSS 攻击
- 控制数据大小
- 处理跨域问题